<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<script>
  document.getElementById("year").textContent = new Date().getFullYear();

  emailjs.init("dKsmeaeNzVRJkgmVc");

  const mentees = {
    "jeremiah": {
      name: "Jeremiah",
      programs: { academics: true, personal: true, entrepreneurship: true },
      progress: {
        academics: { percent: 0, notes: ["Not started yet"] },
        personal: { percent: 0, notes: ["Not started yet"] },
        entrepreneurship: { percent: 0, notes: ["Not started yet"] }
      }
    }
  };

  function loadProgress() {
    const name = document.getElementById("nameInput").value.trim().toLowerCase();
    const error = document.getElementById("errorMsg");

    if (!mentees[name]) {
      error.textContent = "No progress found for this name.";
      return;
    }

    document.getElementById("lookup").style.display = "none";
    document.getElementById("progressCard").style.display = "block";
    document.getElementById("gradesCard").style.display = "block";

    document.getElementById("menteeName").textContent =
      mentees[name].name + "'s Progress Overview";

    document.getElementById("menteeNameForm").value = mentees[name].name;
    error.textContent = "";
  }

  let gradeCount = 3;
  function addGradeRow() {
    gradeCount++;
    const container = document.getElementById("gradesContainer");
    const row = document.createElement("div");
    row.className = "grade-row";
    row.innerHTML = `
      <input type="text" placeholder="Class name" required>
      <input type="number" placeholder="Grade (%)" required>
    `;
    container.appendChild(row);
  }

  document.getElementById("gradesForm").addEventListener("submit", function(e) {
    e.preventDefault();

    let gradesText = "";
    document.querySelectorAll(".grade-row").forEach(row => {
      const cls = row.querySelector("input[type='text']").value;
      const grd = row.querySelector("input[type='number']").value;
      if (cls && grd) {
        gradesText += cls + ": " + grd + "%\n";
      }
    });

    emailjs.send("service_e1wqoft", "template_3ux780j", {
      mentee_name: document.getElementById("menteeNameForm").value,
      mentor_email: document.getElementById("mentor").value,
      grades: gradesText
    })
    .then(() => {
      alert("Grades sent to mentor.");
      document.getElementById("gradesForm").reset();
    })
    .catch(() => {
      alert("Failed to send grades. Try again.");
    });
  });
</script>
